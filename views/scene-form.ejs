<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1><%= title %></h1>
    <form id="sceneForm" action="<%= action %>" method="POST">
        <input type="hidden" name="id" value="<%= scene.id %>">
        <label>Scene Name:</label>
        <input type="text" name="scene_name" value="<%= scene.scene_name %>">
        
        <label>Character:</label>
        <select name="character_id">
            <% characters.forEach(character => { %>
                <option value="<%= character.id %>" <%= character.id == scene.character_id ? 'selected' : '' %>><%= character.name %></option>
            <% }); %>
        </select>

        <div id="steps">
            <h2>Steps</h2>
            <div id="step-list">
                <% (scene.steps || []).forEach(step => { %>
                    <%- include('partials/step-form', { step: step, parts: parts, sounds: sounds }) %>
                <% }); %>
            </div>
            <button type="button" id="addStepButton">Add Step</button>
        </div>

        <button type="submit">Save Scene</button>
    </form>

    <script>
        $(document).ready(function() {
            $('#addStepButton').click(function() {
                $.get('/scenes/new-step', function(data) {
                    $('#step-list').append(data);
                });
            });

            $('#sceneForm').on('click', '.saveStepButton', function() {
                const stepForm = $(this).closest('.stepForm');
                $.post(`/scenes/${stepForm.data('scene-id')}/steps`, stepForm.serialize(), function(data) {
                    alert('Step saved!');
                });
            });
        });
    </script>
</body>
</html>
